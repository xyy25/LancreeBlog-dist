import{openBlock as n,createElementBlock as s,createStaticVNode as a}from"vue";import{_ as t}from"./app-rOduwebr.js";import"katex";const p={},o=a(`<p>分层背景图的特效已经在首页实现，它的内容大致是会随鼠标移动，显现立体感。考虑到实际显示和性能问题，该特效仅在电脑端显示。</p><p>以下大致介绍一下它的代码。</p><p>为此功能，我重写了博客所用的主题<code>vuepress-theme-reco</code>的<code>Banner</code>组件。</p><p><code>MyBanner.vue</code>的大概内容如下：</p><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>banner-wrapper<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isPC ? &#39;pc&#39; : &#39;&#39;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bgImageStyle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 远景层所在的div容器 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isPC<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bgfar<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>banner-bg far<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 近景层所在的div容器 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isPC<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bgnear<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>banner-bg near<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 背景居中内容 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>banner-brand__content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- 我的头像 --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>banner-brand__hero-image<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>heroImage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>heroImage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>heroImageStyle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>heroImage<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- 网站标语 --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HeroText</span> 
          <span class="token attr-name">:text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>frontmatter?.banner?.heroText<span class="token punctuation">&quot;</span></span> 
          <span class="token attr-name">:dark-mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isDarkMode<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">:ruby</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ light: pinyin, dark: kana }<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>banner-brand__hero-tagline<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>frontmatter?.banner?.tagline<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>typing-text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ frontmatter?.banner?.tagline }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- 向下滑动按钮 --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DownIcon</span> <span class="token attr-name">:scroll-to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bgHeight<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 特效所在的组件 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>WindBase</span> <span class="token attr-name">:dark-mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isDarkMode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:is-p-c</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isPC<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>背景一共分为了三个图层:</p><ul><li><strong>天空层<code>sky</code></strong>：背景属性定义在<code>section.banner-wrapper::before</code></li><li><strong>远景层<code>far</code></strong>：背景属性定义在<code>div.banner-bg.far</code></li><li><strong>近景层<code>near</code></strong>：背景属性定义在<code>div.banner-bg.near</code></li></ul><h2 id="css" tabindex="-1"><a class="header-anchor" href="#css" aria-hidden="true">#</a> CSS</h2><p>博客的css用到了postcss和<code>tailwindcss</code>包提供的样式简化写法。</p><p>当然，后者的等价css原形会注释出来。</p><p>背景图片使用了css自定义变量，为了实现在白天和夜间模式下使用不同的背景图。</p><h3 id="天空层" tabindex="-1"><a class="header-anchor" href="#天空层" aria-hidden="true">#</a> 天空层</h3><p>天空层的背景直接绑定在<code>MyBanner</code>组件的根<code>section</code>元素的<strong>伪类</strong><code>::before</code>上。</p><p>之所以在<code>::before</code>伪类设置，是为了防止滤镜<code>filter</code>属性的<code>blur</code>将元素内的其他内容（包含头像与标语）也<strong>一并模糊</strong>了，我只需模糊的是背景图。</p><p>天空层不会随鼠标移动。依照脚本中所写，当系统检测到用户为<strong>电脑端</strong>时，该元素会附上<code>pc</code>类名，并加载分层模式的天空层图层，否则加载全图。</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token selector">.banner-wrapper::before</span> <span class="token punctuation">{</span>
    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
    <span class="token atrule"><span class="token rule">@apply</span> absolute left-0 w-full h-full -z-[100]<span class="token punctuation">;</span></span>
    <span class="token comment">/* 等价于：
      position: absolute;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -100;
    */</span>
    <span class="token atrule"><span class="token rule">@apply</span> blur-[5px]<span class="token punctuation">;</span></span> <span class="token comment">/* filter: blur(5px); */</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 
  pc类名决定了分层特效仅显示在电脑端 
  当元素没有加上pc类名时会直接在section.banner-wrapper上加载背景的合并原图
*/</span>
<span class="token selector">.banner-wrapper:not(.pc)::before</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--background<span class="token punctuation">)</span> center/cover no-repeat<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.banner-wrapper.pc::before</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--background-sky<span class="token punctuation">)</span> center/cover no-repeat<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="远景和近景层" tabindex="-1"><a class="header-anchor" href="#远景和近景层" aria-hidden="true">#</a> 远景和近景层</h3><p>远景和近景层仅在电脑端显示，该设定由脚本中的<code>v-if</code>控制。</p><p>在显示中，远景和近景层会随鼠标位置，进行不同<strong>系数</strong>的位置偏移。</p><p>控制偏移的变量使用了自定义css属性<code>--tl</code>保存，该属性值由脚本实时生成，监测鼠标移动事件<code>mousemove</code>进行更新。</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token selector">div.banner-bg</span> <span class="token punctuation">{</span>
    <span class="token atrule"><span class="token rule">@apply</span> absolute left-0 w-full h-full <span class="token punctuation">;</span></span>
    <span class="token atrule"><span class="token rule">@apply</span> blur-[5px]<span class="token punctuation">;</span></span>
    <span class="token property">background-position</span><span class="token punctuation">:</span> center bottom<span class="token punctuation">;</span>
    <span class="token property">background-repeat</span><span class="token punctuation">:</span> no-repeat<span class="token punctuation">;</span>

    <span class="token comment">/* 远景层 */</span>
    <span class="token selector">&amp;.far</span> <span class="token punctuation">{</span>
        <span class="token atrule"><span class="token rule">@apply</span> -z-[90]<span class="token punctuation">;</span></span> <span class="token comment">/* z-index: -90; */</span>
        <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--background-far<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--tl<span class="token punctuation">)</span> <span class="token function">scale</span><span class="token punctuation">(</span>1.03<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 近景层 */</span>
    <span class="token selector">&amp;.near</span> <span class="token punctuation">{</span>
        <span class="token atrule"><span class="token rule">@apply</span> -z-[80]<span class="token punctuation">;</span></span> <span class="token comment">/* z-index: -80; */</span>
        <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--background-near<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">scale</span><span class="token punctuation">:</span> 1.08<span class="token punctuation">;</span>
        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--tl<span class="token punctuation">)</span> <span class="token function">scale</span><span class="token punctuation">(</span>1.08<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="脚本" tabindex="-1"><a class="header-anchor" href="#脚本" aria-hidden="true">#</a> 脚本</h2><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> computed<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> usePageFrontmatter<span class="token punctuation">,</span> withBase <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vuepress/client&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">APPEARANCE_KEY</span><span class="token punctuation">,</span> <span class="token constant">PREFER_SCHEME_MEDIAKEY</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/.vuepress/client.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> HeroText <span class="token keyword">from</span> <span class="token string">&quot;./HeroText.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> DownIcon <span class="token keyword">from</span> <span class="token string">&quot;./DownIcon.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> WindBase <span class="token keyword">from</span> <span class="token string">&quot;./WindBase.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getAbsolutePos<span class="token punctuation">,</span> isMobile<span class="token punctuation">,</span> throttle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../utils.ts&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> frontmatter <span class="token operator">=</span> usePageFrontmatter<span class="token operator">&lt;</span>Record<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> any<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isPC <span class="token operator">=</span> ref<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> kana <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;ハッ&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ケイ&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;せ&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;かい&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;の&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;うた&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ひめ&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pinyin <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;Bā&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Guì&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Shì&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Jiè&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;De&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Gē&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Jī&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> bg <span class="token operator">=</span> ref<span class="token operator">&lt;</span>HTMLElement<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 天空层DOM引用</span>
<span class="token keyword">const</span> bgfar <span class="token operator">=</span> ref<span class="token operator">&lt;</span>HTMLElement<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 远景层DOM引用</span>
<span class="token keyword">const</span> bgnear <span class="token operator">=</span> ref<span class="token operator">&lt;</span>HTMLElement<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 近景层DOM引用</span>
<span class="token keyword">const</span> mode <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token constant">APPEARANCE_KEY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 保存白天/夜间模式状态的响应变量</span>

<span class="token function">onBeforeMount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  isPC<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">isMobile</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 检测切换夜间模式按钮被按下自定义事件</span>
  <span class="token keyword">const</span> toggleBtns <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;.btn-toggle-dark-mode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  toggleBtns<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;toggleMode&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 背景图分层移动效果的每帧调用逻辑</span>
  <span class="token keyword">const</span> bgMove <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span>
  <span class="token comment">// 仅在电脑端监测鼠标移动，并产生分层的事件</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>isPC<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> <span class="token function">throttle</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> MouseEvent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">bgMove</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.005</span><span class="token punctuation">,</span> <span class="token number">0.004</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.02</span><span class="token punctuation">,</span> <span class="token number">0.012</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 计算值：页面当前是否使用夜间模式</span>
<span class="token keyword">const</span> isDarkMode <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> heroImage <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> heroImageStyle <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span> <span class="token punctuation">)</span>

<span class="token comment">// 根据夜间模式与否切换背景，通过改变自定义属性实现</span>
<span class="token keyword">const</span> bgImageStyle <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> bgImageStyle<span class="token punctuation">,</span> bgImage<span class="token punctuation">,</span> bgImageDark <span class="token punctuation">}</span> <span class="token operator">=</span> frontmatter<span class="token punctuation">.</span>value<span class="token operator">?.</span>banner <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> image <span class="token operator">=</span> isDarkMode<span class="token punctuation">.</span>value <span class="token operator">&amp;&amp;</span> bgImageDark <span class="token operator">?</span> bgImageDark <span class="token operator">:</span> bgImage<span class="token punctuation">;</span>
  <span class="token comment">// 非电脑端所用的非分层图片文件名的格式为： &#39;HomeBg-{模式}&#39;</span>
  <span class="token comment">// 分层图片文件名的格式为： &#39;HomeBg-{模式}-{图层}&#39;</span>
  <span class="token comment">// 如&#39;HomeBg-light-far&#39;表示白天模式下的远景层图片文件。</span>
  <span class="token keyword">const</span> <span class="token function-variable function">asImage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">layer</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> image<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-&#39;</span> <span class="token operator">+</span> layer <span class="token operator">+</span> <span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> initBgImageStyle <span class="token operator">=</span> image <span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">textAlign</span><span class="token operator">:</span> <span class="token string">&#39;center&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">overflow</span><span class="token operator">:</span> <span class="token string">&#39;hidden&#39;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&#39;--background&#39;</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">url(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">withBase</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
    <span class="token string-property property">&#39;--background-sky&#39;</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">url(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">withBase</span><span class="token punctuation">(</span><span class="token function">asImage</span><span class="token punctuation">(</span><span class="token string">&#39;sky&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
    <span class="token string-property property">&#39;--background-far&#39;</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">url(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">withBase</span><span class="token punctuation">(</span><span class="token function">asImage</span><span class="token punctuation">(</span><span class="token string">&#39;far&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
    <span class="token string-property property">&#39;--background-near&#39;</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">url(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">withBase</span><span class="token punctuation">(</span><span class="token function">asImage</span><span class="token punctuation">(</span><span class="token string">&#39;near&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">return</span> bgImageStyle <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>initBgImageStyle<span class="token punctuation">,</span> <span class="token operator">...</span>bgImageStyle <span class="token punctuation">}</span> <span class="token operator">:</span> initBgImageStyle
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>背景层的移动逻辑:</p><p>设置了四个参数，代表背景随鼠标移动偏移的位置<strong>系数</strong>。</p><ul><li><code>fwr</code>、<code>fhr</code>分别表示远景层的水平、垂直移动系数。</li><li><code>nwr</code>、<code>nhr</code>分别表示近景层的水平、垂直移动系数。</li></ul><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// 背景图分层移动效果的每帧调用逻辑</span>
<span class="token keyword">const</span> <span class="token function-variable function">bgMove</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> MouseEvent<span class="token punctuation">,</span> <span class="token punctuation">[</span>fwr<span class="token punctuation">,</span> fhr<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.005</span><span class="token punctuation">,</span> <span class="token number">0.004</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>nwr<span class="token punctuation">,</span> nhr<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.02</span><span class="token punctuation">,</span> <span class="token number">0.012</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>bgfar<span class="token punctuation">.</span>value <span class="token operator">||</span> <span class="token operator">!</span>bgnear<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> pageX<span class="token operator">:</span> x<span class="token punctuation">,</span> pageY<span class="token operator">:</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token operator">:</span> fx<span class="token punctuation">,</span> y<span class="token operator">:</span> fy<span class="token punctuation">,</span> width<span class="token operator">:</span> fw<span class="token punctuation">,</span> height<span class="token operator">:</span> fh <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getAbsolutePos</span><span class="token punctuation">(</span>bgfar<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token operator">:</span> nx<span class="token punctuation">,</span> y<span class="token operator">:</span> ny<span class="token punctuation">,</span> width<span class="token operator">:</span> nw<span class="token punctuation">,</span> height<span class="token operator">:</span> nh <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getAbsolutePos</span><span class="token punctuation">(</span>bgnear<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> ftx <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> fx <span class="token operator">-</span> fw <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> fwr<span class="token punctuation">,</span> fty <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> fy <span class="token operator">-</span> fh <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> fhr<span class="token punctuation">;</span>
  <span class="token keyword">const</span> ntx <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> nx <span class="token operator">-</span> nw <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> nwr<span class="token punctuation">,</span> nty <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> ny <span class="token operator">-</span> nh <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> nhr<span class="token punctuation">;</span>
  bgfar<span class="token punctuation">.</span>value<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&#39;--tl&#39;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ftx<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>fty<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bgnear<span class="token punctuation">.</span>value<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&#39;--tl&#39;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ntx<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>nty<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 仅在电脑端监测鼠标移动，并产生分层的事件</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>isPC<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> <span class="token function">throttle</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>e<span class="token operator">:</span> MouseEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">bgMove</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.005</span><span class="token punctuation">,</span> <span class="token number">0.004</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.02</span><span class="token punctuation">,</span> <span class="token number">0.012</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,27),e=[o];function c(l,u){return n(),s("div",null,e)}const d=t(p,[["render",c],["__file","homebg.html.vue"]]);export{d as default};
